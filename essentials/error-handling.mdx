---
title: é”™è¯¯å¤„ç†
description: AILabTools APIé”™è¯¯å¤„ç†æœ€ä½³å®è·µ
---

# é”™è¯¯å¤„ç†

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨æ­£ç¡®å¤„ç†AILabTools APIå¯èƒ½é‡åˆ°çš„å„ç§é”™è¯¯æƒ…å†µã€‚

## é”™è¯¯å“åº”æ ¼å¼

æ‰€æœ‰APIé”™è¯¯éƒ½éµå¾ªç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼š

```json
{
  "request_id": "req_123456789",
  "log_id": "log_987654321",
  "error_code": 1001,
  "error_detail": {
    "status_code": 400,
    "code": "INVALID_PARAMETER",
    "code_message": "å‚æ•°é”™è¯¯",
    "message": "è¯·æ±‚å‚æ•°æ— æ•ˆï¼šimageå­—æ®µä¸èƒ½ä¸ºç©º"
  }
}
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | æè¿° |
|------|------|
| `request_id` | è¯·æ±‚IDï¼Œç”¨äºé—®é¢˜å®šä½ |
| `log_id` | æ—¥å¿—IDï¼Œç”¨äºæŠ€æœ¯æ”¯æŒ |
| `error_code` | é”™è¯¯ç ï¼Œç”¨äºç¨‹åºåˆ¤æ–­ |
| `error_detail.status_code` | HTTPçŠ¶æ€ç  |
| `error_detail.code` | é”™è¯¯ç±»å‹ä»£ç  |
| `error_detail.code_message` | é”™è¯¯ç±»å‹æè¿° |
| `error_detail.message` | è¯¦ç»†é”™è¯¯ä¿¡æ¯ |

## é”™è¯¯åˆ†ç±»

### 1. å®¢æˆ·ç«¯é”™è¯¯ (4xx)

#### å‚æ•°é”™è¯¯ (1001)
```javascript
// æ£€æŸ¥è¯·æ±‚å‚æ•°
if (response.error_code === 1001) {
  console.error('å‚æ•°é”™è¯¯:', response.error_detail.message);
  // æ£€æŸ¥å¿…éœ€å‚æ•°æ˜¯å¦ç¼ºå¤±
  // æ£€æŸ¥å‚æ•°æ ¼å¼æ˜¯å¦æ­£ç¡®
}
```

#### å›¾ç‰‡æ ¼å¼é”™è¯¯ (1002)
```javascript
if (response.error_code === 1002) {
  console.error('å›¾ç‰‡æ ¼å¼ä¸æ”¯æŒ');
  // è½¬æ¢ä¸ºæ”¯æŒçš„æ ¼å¼ï¼šPNGã€JPGã€JPEG
}
```

#### å›¾ç‰‡å¤§å°é”™è¯¯ (1003)
```javascript
if (response.error_code === 1003) {
  console.error('å›¾ç‰‡å¤§å°è¶…é™');
  // å‹ç¼©å›¾ç‰‡åˆ°3MBä»¥ä¸‹
}
```

#### äººè„¸æ£€æµ‹é”™è¯¯ (1005-1008)
```javascript
if ([1005, 1006, 1007, 1008].includes(response.error_code)) {
  const errorMessages = {
    1005: 'æœªæ£€æµ‹åˆ°äººè„¸',
    1006: 'æ£€æµ‹åˆ°å¤šä¸ªäººè„¸',
    1007: 'äººè„¸è§’åº¦è¿‡å¤§',
    1008: 'äººè„¸å æ¯”è¿‡å°'
  };
  console.error(errorMessages[response.error_code]);
  // å»ºè®®ç”¨æˆ·é‡æ–°ä¸Šä¼ åˆé€‚çš„å›¾ç‰‡
}
```

### 2. è®¤è¯é”™è¯¯ (401/403)

#### è®¤è¯å¤±è´¥ (2001)
```javascript
if (response.error_code === 2001) {
  console.error('APIå¯†é’¥æ— æ•ˆ');
  // æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®
  // é‡æ–°ç”ŸæˆAPIå¯†é’¥
}
```

#### æƒé™ä¸è¶³ (2002)
```javascript
if (response.error_code === 2002) {
  console.error('æƒé™ä¸è¶³');
  // å‡çº§è´¦æˆ·æˆ–è”ç³»å®¢æœ
}
```

### 3. æœåŠ¡å™¨é”™è¯¯ (5xx)

#### æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ (5001)
```javascript
if (response.error_code === 5001) {
  console.error('æœåŠ¡å™¨é”™è¯¯');
  // ç¨åé‡è¯•
  // å®ç°æŒ‡æ•°é€€é¿é‡è¯•
}
```

## é‡è¯•ç­–ç•¥

### 1. æŒ‡æ•°é€€é¿é‡è¯•

```javascript
async function callAPIWithRetry(apiCall, maxRetries = 3) {
  for (let attempt = 0; attempt < maxRetries; attempt++) {
    try {
      const result = await apiCall();
      
      // æ£€æŸ¥æ˜¯å¦æˆåŠŸ
      if (result.error_code === 0) {
        return result;
      }
      
      // å¯¹äºå®¢æˆ·ç«¯é”™è¯¯ï¼Œä¸è¿›è¡Œé‡è¯•
      if (result.error_code >= 1001 && result.error_code <= 2003) {
        throw new Error(result.error_detail.message);
      }
      
      // å¯¹äºæœåŠ¡å™¨é”™è¯¯ï¼Œè¿›è¡Œé‡è¯•
      if (result.error_code >= 5001) {
        const delay = Math.pow(2, attempt) * 1000; // æŒ‡æ•°é€€é¿
        console.log(`é‡è¯• ${attempt + 1}/${maxRetries}ï¼Œç­‰å¾… ${delay}ms`);
        await new Promise(resolve => setTimeout(resolve, delay));
        continue;
      }
      
      throw new Error(result.error_detail.message);
      
    } catch (error) {
      if (attempt === maxRetries - 1) {
        throw error;
      }
      
      // ç½‘ç»œé”™è¯¯ä¹Ÿè¿›è¡Œé‡è¯•
      if (error.name === 'NetworkError' || error.code === 'NETWORK_ERROR') {
        const delay = Math.pow(2, attempt) * 1000;
        await new Promise(resolve => setTimeout(resolve, delay));
        continue;
      }
      
      throw error;
    }
  }
}
```

### 2. å¼‚æ­¥ä»»åŠ¡è½®è¯¢é‡è¯•

```javascript
async function pollTaskResult(taskId, maxAttempts = 100) {
  for (let attempt = 0; attempt < maxAttempts; attempt++) {
    try {
      const response = await fetch(
        `https://api.ailabtools.com/v1/async-task-results?task_id=${taskId}`,
        {
          headers: {
            'Authorization': 'Bearer YOUR_API_KEY'
          }
        }
      );
      
      const result = await response.json();
      
      if (result.error_code !== 0) {
        // å¤„ç†é”™è¯¯
        if (result.error_code === 3001) {
          throw new Error('ä»»åŠ¡ä¸å­˜åœ¨');
        } else if (result.error_code === 3002) {
          throw new Error('ä»»åŠ¡å·²è¿‡æœŸ');
        } else {
          throw new Error(result.error_detail.message);
        }
      }
      
      const status = result.result.status;
      
      if (status === 'completed') {
        return result.result.result_image;
      } else if (status === 'failed') {
        throw new Error('ä»»åŠ¡å¤„ç†å¤±è´¥');
      }
      
      // ç­‰å¾…5ç§’åé‡è¯•
      await new Promise(resolve => setTimeout(resolve, 5000));
      
    } catch (error) {
      if (attempt === maxAttempts - 1) {
        throw new Error('æŸ¥è¯¢è¶…æ—¶');
      }
      
      // ç½‘ç»œé”™è¯¯é‡è¯•
      if (error.name === 'NetworkError') {
        await new Promise(resolve => setTimeout(resolve, 5000));
        continue;
      }
      
      throw error;
    }
  }
}
```

## ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

### 1. é”™è¯¯æ¶ˆæ¯æ˜ å°„

```javascript
const ERROR_MESSAGES = {
  1001: 'è¯·æ±‚å‚æ•°æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥',
  1002: 'å›¾ç‰‡æ ¼å¼ä¸æ”¯æŒï¼Œè¯·ä½¿ç”¨PNGã€JPGæˆ–JPEGæ ¼å¼',
  1003: 'å›¾ç‰‡å¤ªå¤§ï¼Œè¯·ä½¿ç”¨å°äº3MBçš„å›¾ç‰‡',
  1004: 'å›¾ç‰‡åˆ†è¾¨ç‡ä¸ç¬¦åˆè¦æ±‚',
  1005: 'æœªæ£€æµ‹åˆ°äººè„¸ï¼Œè¯·ç¡®ä¿å›¾ç‰‡åŒ…å«æ¸…æ™°çš„äººè„¸',
  1006: 'æ£€æµ‹åˆ°å¤šä¸ªäººè„¸ï¼Œè¯·ä½¿ç”¨åªåŒ…å«ä¸€ä¸ªäººè„¸çš„å›¾ç‰‡',
  1007: 'äººè„¸è§’åº¦è¿‡å¤§ï¼Œè¯·ä½¿ç”¨æ­£é¢ç…§ç‰‡',
  1008: 'äººè„¸å¤ªå°ï¼Œè¯·ä½¿ç”¨äººè„¸å æ¯”æ›´å¤§çš„å›¾ç‰‡',
  2001: 'APIå¯†é’¥æ— æ•ˆï¼Œè¯·æ£€æŸ¥å¯†é’¥',
  2002: 'æƒé™ä¸è¶³ï¼Œè¯·å‡çº§è´¦æˆ·',
  2003: 'è´¦æˆ·è¢«ç¦ç”¨ï¼Œè¯·è”ç³»å®¢æœ',
  3001: 'ä»»åŠ¡ä¸å­˜åœ¨',
  3002: 'ä»»åŠ¡å·²è¿‡æœŸï¼Œè¯·é‡æ–°æäº¤',
  3003: 'ä»»åŠ¡å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•',
  4001: 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•',
  5001: 'æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•',
  5002: 'æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•'
};

function getErrorMessage(errorCode) {
  return ERROR_MESSAGES[errorCode] || 'æœªçŸ¥é”™è¯¯ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒ';
}
```

### 2. é”™è¯¯å¤„ç†ç»„ä»¶

```javascript
// Reactç»„ä»¶ç¤ºä¾‹
function ErrorHandler({ error, onRetry }) {
  const getErrorIcon = (errorCode) => {
    if (errorCode >= 1001 && errorCode <= 1008) {
      return 'ğŸ“·'; // å›¾ç‰‡ç›¸å…³é”™è¯¯
    } else if (errorCode >= 2001 && errorCode <= 2003) {
      return 'ğŸ”‘'; // è®¤è¯ç›¸å…³é”™è¯¯
    } else if (errorCode >= 5001) {
      return 'ğŸ”§'; // æœåŠ¡å™¨é”™è¯¯
    }
    return 'âŒ';
  };

  return (
    <div className="error-container">
      <div className="error-icon">
        {getErrorIcon(error.error_code)}
      </div>
      <div className="error-content">
        <h3>å¤„ç†å¤±è´¥</h3>
        <p>{getErrorMessage(error.error_code)}</p>
        <div className="error-actions">
          <button onClick={onRetry}>é‡è¯•</button>
          <button onClick={() => window.location.reload()}>åˆ·æ–°é¡µé¢</button>
        </div>
      </div>
    </div>
  );
}
```

## æ—¥å¿—è®°å½•

### 1. é”™è¯¯æ—¥å¿—

```javascript
function logError(error, context = {}) {
  const errorLog = {
    timestamp: new Date().toISOString(),
    error_code: error.error_code,
    error_message: error.error_detail.message,
    request_id: error.request_id,
    log_id: error.log_id,
    context: context
  };
  
  // å‘é€åˆ°æ—¥å¿—æœåŠ¡
  console.error('API Error:', errorLog);
  
  // å¯ä»¥å‘é€åˆ°å¤–éƒ¨æ—¥å¿—æœåŠ¡
  // sendToLogService(errorLog);
}
```

### 2. æ€§èƒ½ç›‘æ§

```javascript
async function callAPIWithMonitoring(apiCall, apiName) {
  const startTime = Date.now();
  
  try {
    const result = await apiCall();
    const duration = Date.now() - startTime;
    
    // è®°å½•æˆåŠŸè°ƒç”¨
    console.log(`${apiName} è°ƒç”¨æˆåŠŸï¼Œè€—æ—¶: ${duration}ms`);
    
    return result;
  } catch (error) {
    const duration = Date.now() - startTime;
    
    // è®°å½•å¤±è´¥è°ƒç”¨
    console.error(`${apiName} è°ƒç”¨å¤±è´¥ï¼Œè€—æ—¶: ${duration}ms`, error);
    
    throw error;
  }
}
```

## æœ€ä½³å®è·µ

### 1. å‰ç«¯éªŒè¯

åœ¨è°ƒç”¨APIå‰è¿›è¡Œå‰ç«¯éªŒè¯ï¼š

```javascript
function validateBeforeUpload(file) {
  const errors = [];
  
  // æ£€æŸ¥æ–‡ä»¶å¤§å°
  if (file.size > 3 * 1024 * 1024) {
    errors.push('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡3MB');
  }
  
  // æ£€æŸ¥æ–‡ä»¶ç±»å‹
  const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];
  if (!allowedTypes.includes(file.type)) {
    errors.push('åªæ”¯æŒJPGã€JPEGã€PNGæ ¼å¼');
  }
  
  return errors;
}
```

### 2. ä¼˜é›…é™çº§

```javascript
async function processImage(imageFile) {
  try {
    // å°è¯•ä½¿ç”¨AIå¤„ç†
    const result = await callHairstyleAPI(imageFile);
    return result;
  } catch (error) {
    if (error.error_code === 1005) {
      // å¦‚æœæ£€æµ‹ä¸åˆ°äººè„¸ï¼Œæä¾›æ‰‹åŠ¨è£å‰ªé€‰é¡¹
      return showManualCropDialog(imageFile);
    }
    
    // å…¶ä»–é”™è¯¯ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    showErrorMessage(error);
  }
}
```

### 3. ç”¨æˆ·å¼•å¯¼

```javascript
function showErrorGuidance(errorCode) {
  const guidance = {
    1005: 'è¯·ç¡®ä¿å›¾ç‰‡ä¸­æœ‰æ¸…æ™°çš„äººè„¸ï¼Œå»ºè®®ä½¿ç”¨æ­£é¢ç…§ç‰‡',
    1006: 'è¯·é€‰æ‹©åªåŒ…å«ä¸€ä¸ªäººè„¸çš„å›¾ç‰‡',
    1007: 'è¯·ä½¿ç”¨æ­£é¢æˆ–æ¥è¿‘æ­£é¢çš„ç…§ç‰‡',
    1008: 'è¯·é€‰æ‹©äººè„¸å æ¯”æ›´å¤§çš„å›¾ç‰‡ï¼Œå»ºè®®äººè„¸å å›¾ç‰‡20%-50%'
  };
  
  return guidance[errorCode] || 'è¯·æ£€æŸ¥å›¾ç‰‡æ˜¯å¦ç¬¦åˆè¦æ±‚';
}
```

## è”ç³»æ”¯æŒ

å¦‚æœé‡åˆ°æ— æ³•è§£å†³çš„é”™è¯¯ï¼Œè¯·ï¼š

1. è®°å½•å®Œæ•´çš„é”™è¯¯å“åº”ï¼ˆåŒ…æ‹¬request_idå’Œlog_idï¼‰
2. æè¿°æ‚¨æ‰§è¡Œçš„æ“ä½œæ­¥éª¤
3. æä¾›ç›¸å…³çš„ä»£ç ç‰‡æ®µ
4. è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ

<CTA href="mailto:support@ailabtools.com">
  è”ç³»æŠ€æœ¯æ”¯æŒ
</CTA>
