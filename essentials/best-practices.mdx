---
title: æœ€ä½³å®è·µ
description: AILabTools APIä½¿ç”¨æœ€ä½³å®è·µå’Œæ€§èƒ½ä¼˜åŒ–
---

# æœ€ä½³å®è·µ

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨ä»¥æœ€é«˜æ•ˆã€æœ€å®‰å…¨çš„æ–¹å¼ä½¿ç”¨AILabTools APIã€‚

## æ€§èƒ½ä¼˜åŒ–

### 1. å›¾ç‰‡é¢„å¤„ç†

åœ¨ä¸Šä¼ å‰å¯¹å›¾ç‰‡è¿›è¡Œé¢„å¤„ç†å¯ä»¥æ˜¾è‘—æé«˜å¤„ç†é€Ÿåº¦å’ŒæˆåŠŸç‡ï¼š

```javascript
// JavaScriptå›¾ç‰‡é¢„å¤„ç†
async function preprocessImage(file) {
  return new Promise((resolve) => {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();
    
    img.onload = function() {
      // è®¡ç®—æœ€ä½³å°ºå¯¸
      const maxSize = 1200;
      let { width, height } = img;
      
      if (width > maxSize || height > maxSize) {
        if (width > height) {
          height = (height * maxSize) / width;
          width = maxSize;
        } else {
          width = (width * maxSize) / height;
          height = maxSize;
        }
      }
      
      canvas.width = width;
      canvas.height = height;
      
      // ç»˜åˆ¶å¹¶å‹ç¼©
      ctx.drawImage(img, 0, 0, width, height);
      
      canvas.toBlob((blob) => {
        resolve(blob);
      }, 'image/jpeg', 0.85);
    };
    
    img.src = URL.createObjectURL(file);
  });
}
```

```python
# Pythonå›¾ç‰‡é¢„å¤„ç†
from PIL import Image
import io

def preprocess_image(image_path, output_path=None):
    """é¢„å¤„ç†å›¾ç‰‡ä»¥è·å¾—æœ€ä½³æ•ˆæœ"""
    with Image.open(image_path) as img:
        # è½¬æ¢ä¸ºRGBæ¨¡å¼
        if img.mode != 'RGB':
            img = img.convert('RGB')
        
        # è°ƒæ•´åˆ†è¾¨ç‡
        max_size = 1200
        if max(img.size) > max_size:
            img.thumbnail((max_size, max_size), Image.Resampling.LANCZOS)
        
        # ä¿å­˜ä¼˜åŒ–åçš„å›¾ç‰‡
        if output_path is None:
            output_path = image_path.replace('.', '_optimized.')
        
        img.save(output_path, 'JPEG', quality=85, optimize=True)
        return output_path
```

### 2. æ‰¹é‡å¤„ç†ä¼˜åŒ–

å¯¹äºå¤§é‡å›¾ç‰‡å¤„ç†ï¼Œä½¿ç”¨å¹¶å‘è¯·æ±‚å¯ä»¥æé«˜æ•ˆç‡ï¼š

```javascript
// JavaScriptæ‰¹é‡å¤„ç†
async function batchProcessImages(imageFiles, concurrency = 3) {
  const results = [];
  const chunks = [];
  
  // åˆ†æ‰¹å¤„ç†
  for (let i = 0; i < imageFiles.length; i += concurrency) {
    chunks.push(imageFiles.slice(i, i + concurrency));
  }
  
  for (const chunk of chunks) {
    const promises = chunk.map(async (file) => {
      try {
        const processedFile = await preprocessImage(file);
        const result = await callHairstyleAPI(processedFile);
        return { success: true, result };
      } catch (error) {
        return { success: false, error };
      }
    });
    
    const chunkResults = await Promise.all(promises);
    results.push(...chunkResults);
    
    // é¿å…è§¦å‘é€Ÿç‡é™åˆ¶
    await new Promise(resolve => setTimeout(resolve, 1000));
  }
  
  return results;
}
```

```python
# Pythonæ‰¹é‡å¤„ç†
import asyncio
import aiohttp
from concurrent.futures import ThreadPoolExecutor

async def batch_process_images(image_paths, api_key, concurrency=3):
    """å¹¶å‘æ‰¹é‡å¤„ç†å›¾ç‰‡"""
    semaphore = asyncio.Semaphore(concurrency)
    
    async def process_single_image(image_path):
        async with semaphore:
            try:
                # é¢„å¤„ç†å›¾ç‰‡
                optimized_path = preprocess_image(image_path)
                
                # è°ƒç”¨API
                async with aiohttp.ClientSession() as session:
                    with open(optimized_path, 'rb') as f:
                        image_data = f.read()
                    
                    headers = {
                        'Authorization': f'Bearer {api_key}',
                        'Content-Type': 'application/json'
                    }
                    
                    data = {
                        'image': f'data:image/jpeg;base64,{base64.b64encode(image_data).decode()}'
                    }
                    
                    async with session.post(
                        'https://api.ailabtools.com/v1/hairstyle-editor-pro',
                        headers=headers,
                        json=data
                    ) as response:
                        result = await response.json()
                        return {'success': True, 'result': result}
                        
            except Exception as e:
                return {'success': False, 'error': str(e)}
    
    tasks = [process_single_image(path) for path in image_paths]
    return await asyncio.gather(*tasks)
```

### 3. ç¼“å­˜ç­–ç•¥

å®ç°æ™ºèƒ½ç¼“å­˜ä»¥å‡å°‘é‡å¤è¯·æ±‚ï¼š

```javascript
// JavaScriptç¼“å­˜å®ç°
class APICache {
  constructor(maxSize = 100) {
    this.cache = new Map();
    this.maxSize = maxSize;
  }
  
  generateKey(imageData, options) {
    // åŸºäºå›¾ç‰‡æ•°æ®å’Œé€‰é¡¹ç”Ÿæˆç¼“å­˜é”®
    const hash = this.hashString(imageData + JSON.stringify(options));
    return `cache_${hash}`;
  }
  
  async get(key) {
    const cached = this.cache.get(key);
    if (cached && Date.now() - cached.timestamp < 24 * 60 * 60 * 1000) {
      return cached.data;
    }
    return null;
  }
  
  set(key, data) {
    if (this.cache.size >= this.maxSize) {
      // åˆ é™¤æœ€æ—§çš„ç¼“å­˜
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    
    this.cache.set(key, {
      data,
      timestamp: Date.now()
    });
  }
  
  hashString(str) {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
      const char = str.charCodeAt(i);
      hash = ((hash << 5) - hash) + char;
      hash = hash & hash; // è½¬æ¢ä¸º32ä½æ•´æ•°
    }
    return hash;
  }
}

const apiCache = new APICache();

async function callAPIWithCache(imageData, options) {
  const cacheKey = apiCache.generateKey(imageData, options);
  
  // å°è¯•ä»ç¼“å­˜è·å–
  const cached = await apiCache.get(cacheKey);
  if (cached) {
    return cached;
  }
  
  // è°ƒç”¨API
  const result = await callHairstyleAPI(imageData, options);
  
  // ç¼“å­˜ç»“æœ
  apiCache.set(cacheKey, result);
  
  return result;
}
```

## é”™è¯¯å¤„ç†æœ€ä½³å®è·µ

### 1. åˆ†å±‚é”™è¯¯å¤„ç†

```javascript
// åˆ†å±‚é”™è¯¯å¤„ç†ç­–ç•¥
class ErrorHandler {
  static async handleAPIError(error, context) {
    // è®°å½•é”™è¯¯
    this.logError(error, context);
    
    // æ ¹æ®é”™è¯¯ç±»å‹é‡‡å–ä¸åŒç­–ç•¥
    switch (error.error_code) {
      case 1001:
        return this.handleParameterError(error);
      case 1005:
        return this.handleFaceDetectionError(error);
      case 2001:
        return this.handleAuthError(error);
      case 5001:
        return this.handleServerError(error);
      default:
        return this.handleUnknownError(error);
    }
  }
  
  static handleParameterError(error) {
    return {
      type: 'validation',
      message: 'è¯·æ£€æŸ¥è¾“å…¥å‚æ•°',
      action: 'retry_with_correction'
    };
  }
  
  static handleFaceDetectionError(error) {
    return {
      type: 'image_quality',
      message: 'è¯·ä¸Šä¼ åŒ…å«æ¸…æ™°äººè„¸çš„å›¾ç‰‡',
      action: 'upload_better_image'
    };
  }
  
  static handleAuthError(error) {
    return {
      type: 'authentication',
      message: 'APIå¯†é’¥æ— æ•ˆï¼Œè¯·æ£€æŸ¥é…ç½®',
      action: 'check_api_key'
    };
  }
  
  static handleServerError(error) {
    return {
      type: 'server',
      message: 'æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•',
      action: 'retry_later'
    };
  }
  
  static logError(error, context) {
    console.error('API Error:', {
      error_code: error.error_code,
      message: error.error_detail.message,
      request_id: error.request_id,
      context
    });
  }
}
```

### 2. ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

```javascript
// ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤ºç»„ä»¶
function UserFriendlyError({ error, onRetry, onUploadNew }) {
  const getErrorUI = () => {
    switch (error.error_code) {
      case 1005:
        return {
          icon: 'ğŸ‘¤',
          title: 'æœªæ£€æµ‹åˆ°äººè„¸',
          description: 'è¯·ç¡®ä¿å›¾ç‰‡ä¸­æœ‰æ¸…æ™°çš„äººè„¸',
          actions: [
            { label: 'é‡æ–°ä¸Šä¼ ', onClick: onUploadNew },
            { label: 'æŸ¥çœ‹è¦æ±‚', onClick: () => window.open('/guides/image-requirements') }
          ]
        };
      
      case 1006:
        return {
          icon: 'ğŸ‘¥',
          title: 'æ£€æµ‹åˆ°å¤šä¸ªäººè„¸',
          description: 'è¯·é€‰æ‹©åªåŒ…å«ä¸€ä¸ªäººè„¸çš„å›¾ç‰‡',
          actions: [
            { label: 'é‡æ–°ä¸Šä¼ ', onClick: onUploadNew }
          ]
        };
      
      case 2001:
        return {
          icon: 'ğŸ”‘',
          title: 'è®¤è¯å¤±è´¥',
          description: 'è¯·æ£€æŸ¥APIå¯†é’¥é…ç½®',
          actions: [
            { label: 'æ£€æŸ¥é…ç½®', onClick: () => window.open('/guides/authentication') }
          ]
        };
      
      default:
        return {
          icon: 'âŒ',
          title: 'å¤„ç†å¤±è´¥',
          description: 'è¯·ç¨åé‡è¯•æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ',
          actions: [
            { label: 'é‡è¯•', onClick: onRetry },
            { label: 'è”ç³»æ”¯æŒ', onClick: () => window.open('mailto:support@ailabtools.com') }
          ]
        };
    }
  };
  
  const errorUI = getErrorUI();
  
  return (
    <div className="error-container">
      <div className="error-icon">{errorUI.icon}</div>
      <h3>{errorUI.title}</h3>
      <p>{errorUI.description}</p>
      <div className="error-actions">
        {errorUI.actions.map((action, index) => (
          <button key={index} onClick={action.onClick}>
            {action.label}
          </button>
        ))}
      </div>
    </div>
  );
}
```

## å®‰å…¨æœ€ä½³å®è·µ

### 1. APIå¯†é’¥ç®¡ç†

```javascript
// å®‰å…¨çš„APIå¯†é’¥ç®¡ç†
class SecureAPIKeyManager {
  constructor() {
    this.apiKey = null;
  }
  
  // ä»ç¯å¢ƒå˜é‡æˆ–å®‰å…¨å­˜å‚¨è·å–APIå¯†é’¥
  async getAPIKey() {
    if (this.apiKey) {
      return this.apiKey;
    }
    
    // åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä»ç¯å¢ƒå˜é‡è·å–
    if (process.env.NODE_ENV === 'production') {
      this.apiKey = process.env.AILABTOOLS_API_KEY;
    } else {
      // åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œä»é…ç½®æ–‡ä»¶è·å–
      this.apiKey = await this.loadFromConfig();
    }
    
    if (!this.apiKey) {
      throw new Error('APIå¯†é’¥æœªé…ç½®');
    }
    
    return this.apiKey;
  }
  
  // éªŒè¯APIå¯†é’¥æ ¼å¼
  validateAPIKey(apiKey) {
    return /^sk-[a-zA-Z0-9]{32}$/.test(apiKey);
  }
  
  // å®šæœŸè½®æ¢APIå¯†é’¥
  async rotateAPIKey() {
    // å®ç°APIå¯†é’¥è½®æ¢é€»è¾‘
    console.log('å»ºè®®å®šæœŸè½®æ¢APIå¯†é’¥ä»¥æé«˜å®‰å…¨æ€§');
  }
}
```

### 2. è¯·æ±‚ç­¾åéªŒè¯

```javascript
// è¯·æ±‚ç­¾åéªŒè¯ï¼ˆå¯é€‰ï¼‰
class RequestSigner {
  constructor(apiKey) {
    this.apiKey = apiKey;
  }
  
  signRequest(data) {
    const timestamp = Date.now();
    const nonce = this.generateNonce();
    const signature = this.generateSignature(data, timestamp, nonce);
    
    return {
      'X-Timestamp': timestamp,
      'X-Nonce': nonce,
      'X-Signature': signature
    };
  }
  
  generateNonce() {
    return Math.random().toString(36).substring(2, 15);
  }
  
  generateSignature(data, timestamp, nonce) {
    const message = JSON.stringify(data) + timestamp + nonce;
    // ä½¿ç”¨HMAC-SHA256ç”Ÿæˆç­¾å
    return this.hmacSHA256(message, this.apiKey);
  }
}
```

## ç›‘æ§å’Œåˆ†æ

### 1. æ€§èƒ½ç›‘æ§

```javascript
// æ€§èƒ½ç›‘æ§
class PerformanceMonitor {
  constructor() {
    this.metrics = {
      totalRequests: 0,
      successfulRequests: 0,
      failedRequests: 0,
      averageResponseTime: 0,
      totalResponseTime: 0
    };
  }
  
  async trackAPIRequest(apiCall, apiName) {
    const startTime = Date.now();
    this.metrics.totalRequests++;
    
    try {
      const result = await apiCall();
      const duration = Date.now() - startTime;
      
      this.metrics.successfulRequests++;
      this.metrics.totalResponseTime += duration;
      this.metrics.averageResponseTime = 
        this.metrics.totalResponseTime / this.metrics.successfulRequests;
      
      this.logSuccess(apiName, duration);
      return result;
      
    } catch (error) {
      this.metrics.failedRequests++;
      this.logError(apiName, error);
      throw error;
    }
  }
  
  getMetrics() {
    return {
      ...this.metrics,
      successRate: this.metrics.successfulRequests / this.metrics.totalRequests
    };
  }
  
  logSuccess(apiName, duration) {
    console.log(`${apiName} è°ƒç”¨æˆåŠŸï¼Œè€—æ—¶: ${duration}ms`);
  }
  
  logError(apiName, error) {
    console.error(`${apiName} è°ƒç”¨å¤±è´¥:`, error);
  }
}
```

### 2. ä½¿ç”¨ç»Ÿè®¡

```javascript
// ä½¿ç”¨ç»Ÿè®¡
class UsageTracker {
  constructor() {
    this.usage = {
      daily: {},
      monthly: {}
    };
  }
  
  trackUsage(apiName, success = true) {
    const today = new Date().toISOString().split('T')[0];
    const month = new Date().toISOString().slice(0, 7);
    
    // è®°å½•æ¯æ—¥ä½¿ç”¨æƒ…å†µ
    if (!this.usage.daily[today]) {
      this.usage.daily[today] = {};
    }
    if (!this.usage.daily[today][apiName]) {
      this.usage.daily[today][apiName] = { success: 0, failed: 0 };
    }
    
    if (success) {
      this.usage.daily[today][apiName].success++;
    } else {
      this.usage.daily[today][apiName].failed++;
    }
    
    // è®°å½•æ¯æœˆä½¿ç”¨æƒ…å†µ
    if (!this.usage.monthly[month]) {
      this.usage.monthly[month] = {};
    }
    if (!this.usage.monthly[month][apiName]) {
      this.usage.monthly[month][apiName] = { success: 0, failed: 0 };
    }
    
    if (success) {
      this.usage.monthly[month][apiName].success++;
    } else {
      this.usage.monthly[month][apiName].failed++;
    }
  }
  
  getUsageReport() {
    return {
      daily: this.usage.daily,
      monthly: this.usage.monthly,
      summary: this.calculateSummary()
    };
  }
  
  calculateSummary() {
    const totalSuccess = Object.values(this.usage.monthly)
      .flatMap(month => Object.values(month))
      .reduce((sum, api) => sum + api.success, 0);
    
    const totalFailed = Object.values(this.usage.monthly)
      .flatMap(month => Object.values(month))
      .reduce((sum, api) => sum + api.failed, 0);
    
    return {
      totalRequests: totalSuccess + totalFailed,
      successRate: totalSuccess / (totalSuccess + totalFailed)
    };
  }
}
```

## é›†æˆæœ€ä½³å®è·µ

### 1. React Hook

```javascript
// React Hook for APIè°ƒç”¨
import { useState, useCallback } from 'react';

function useAILabToolsAPI() {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [result, setResult] = useState(null);
  
  const processImage = useCallback(async (imageFile, options = {}) => {
    setLoading(true);
    setError(null);
    
    try {
      // é¢„å¤„ç†å›¾ç‰‡
      const processedFile = await preprocessImage(imageFile);
      
      // è°ƒç”¨API
      const response = await callHairstyleAPI(processedFile, options);
      
      if (response.error_code === 0) {
        // è½®è¯¢è·å–ç»“æœ
        const finalResult = await pollTaskResult(response.result.task_id);
        setResult(finalResult);
      } else {
        throw new Error(response.error_detail.message);
      }
      
    } catch (err) {
      setError(err);
    } finally {
      setLoading(false);
    }
  }, []);
  
  return {
    processImage,
    loading,
    error,
    result
  };
}
```

### 2. Vue 3 Composition API

```javascript
// Vue 3 Composition API
import { ref, computed } from 'vue';

export function useAILabToolsAPI() {
  const loading = ref(false);
  const error = ref(null);
  const result = ref(null);
  
  const processImage = async (imageFile, options = {}) => {
    loading.value = true;
    error.value = null;
    
    try {
      const processedFile = await preprocessImage(imageFile);
      const response = await callHairstyleAPI(processedFile, options);
      
      if (response.error_code === 0) {
        const finalResult = await pollTaskResult(response.result.task_id);
        result.value = finalResult;
      } else {
        throw new Error(response.error_detail.message);
      }
      
    } catch (err) {
      error.value = err;
    } finally {
      loading.value = false;
    }
  };
  
  const hasError = computed(() => error.value !== null);
  const hasResult = computed(() => result.value !== null);
  
  return {
    processImage,
    loading,
    error,
    result,
    hasError,
    hasResult
  };
}
```

## æ€»ç»“

éµå¾ªè¿™äº›æœ€ä½³å®è·µå¯ä»¥ï¼š

- **æé«˜æ€§èƒ½**: é€šè¿‡é¢„å¤„ç†ã€ç¼“å­˜å’Œå¹¶å‘å¤„ç†
- **å¢å¼ºå¯é æ€§**: é€šè¿‡å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- **æ”¹å–„ç”¨æˆ·ä½“éªŒ**: é€šè¿‡å‹å¥½çš„é”™è¯¯æç¤ºå’ŒåŠ è½½çŠ¶æ€
- **ç¡®ä¿å®‰å…¨**: é€šè¿‡å®‰å…¨çš„APIå¯†é’¥ç®¡ç†
- **ä¾¿äºç»´æŠ¤**: é€šè¿‡ç›‘æ§å’Œåˆ†æåŠŸèƒ½

<CTA href="/api/reference">
  æŸ¥çœ‹å®Œæ•´APIæ–‡æ¡£
</CTA>
