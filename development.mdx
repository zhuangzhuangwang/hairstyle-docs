---
title: 开发指南
description: AILabTools API开发指南和集成方案
---

# 开发指南

本指南将帮助您快速集成AILabTools API到您的应用程序中。

## 集成方案

### 1. Web应用集成

#### React集成

```javascript
import React, { useState, useCallback } from 'react';

function useAILabToolsAPI() {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [result, setResult] = useState(null);
  
  const processImage = useCallback(async (imageFile, options = {}) => {
    setLoading(true);
    setError(null);
    
    try {
      // 预处理图片
      const processedFile = await preprocessImage(imageFile);
      
      // 调用API
      const response = await fetch('https://api.ailabtools.com/v1/hairstyle-editor-pro', {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer YOUR_API_KEY',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          image: processedFile,
          ...options
        })
      });
      
      const result = await response.json();
      
      if (result.error_code === 0) {
        // 轮询获取结果
        const finalResult = await pollTaskResult(result.result.task_id);
        setResult(finalResult);
      } else {
        throw new Error(result.error_detail.message);
      }
      
    } catch (err) {
      setError(err);
    } finally {
      setLoading(false);
    }
  }, []);
  
  return {
    processImage,
    loading,
    error,
    result
  };
}

// 使用示例
function HairstyleEditor() {
  const { processImage, loading, error, result } = useAILabToolsAPI();
  const [selectedFile, setSelectedFile] = useState(null);
  
  const handleFileChange = (event) => {
    setSelectedFile(event.target.files[0]);
  };
  
  const handleProcess = async () => {
    if (selectedFile) {
      await processImage(selectedFile, {
        hairstyle: 'short',
        hair_color: 'black'
      });
    }
  };
  
  return (
    <div>
      <input type="file" onChange={handleFileChange} accept="image/*" />
      <button onClick={handleProcess} disabled={loading || !selectedFile}>
        {loading ? '处理中...' : '开始处理'}
      </button>
      
      {error && <div className="error">{error.message}</div>}
      {result && <img src={result} alt="处理结果" />}
    </div>
  );
}
```

#### Vue 3集成

```javascript
import { ref, computed } from 'vue';

export function useAILabToolsAPI() {
  const loading = ref(false);
  const error = ref(null);
  const result = ref(null);
  
  const processImage = async (imageFile, options = {}) => {
    loading.value = true;
    error.value = null;
    
    try {
      const processedFile = await preprocessImage(imageFile);
      
      const response = await fetch('https://api.ailabtools.com/v1/hairstyle-editor-pro', {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer YOUR_API_KEY',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          image: processedFile,
          ...options
        })
      });
      
      const apiResult = await response.json();
      
      if (apiResult.error_code === 0) {
        const finalResult = await pollTaskResult(apiResult.result.task_id);
        result.value = finalResult;
      } else {
        throw new Error(apiResult.error_detail.message);
      }
      
    } catch (err) {
      error.value = err;
    } finally {
      loading.value = false;
    }
  };
  
  const hasError = computed(() => error.value !== null);
  const hasResult = computed(() => result.value !== null);
  
  return {
    processImage,
    loading,
    error,
    result,
    hasError,
    hasResult
  };
}
```

### 2. 移动应用集成

#### React Native集成

```javascript
import React, { useState } from 'react';
import { View, Text, TouchableOpacity, Image, Alert } from 'react-native';
import * as ImagePicker from 'expo-image-picker';

const AILabToolsAPI = () => {
  const [loading, setLoading] = useState(false);
  const [result, setResult] = useState(null);
  
  const pickImage = async () => {
    const result = await ImagePicker.launchImageLibraryAsync({
      mediaTypes: ImagePicker.MediaTypeOptions.Images,
      allowsEditing: true,
      aspect: [1, 1],
      quality: 0.8,
    });
    
    if (!result.canceled) {
      await processImage(result.assets[0].uri);
    }
  };
  
  const processImage = async (imageUri) => {
    setLoading(true);
    
    try {
      // 将图片转换为Base64
      const base64Image = await imageToBase64(imageUri);
      
      const response = await fetch('https://api.ailabtools.com/v1/hairstyle-editor-pro', {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer YOUR_API_KEY',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          image: `data:image/jpeg;base64,${base64Image}`,
          hairstyle: 'short',
          hair_color: 'black'
        })
      });
      
      const result = await response.json();
      
      if (result.error_code === 0) {
        const finalResult = await pollTaskResult(result.result.task_id);
        setResult(finalResult);
      } else {
        Alert.alert('错误', result.error_detail.message);
      }
      
    } catch (error) {
      Alert.alert('错误', '处理失败，请重试');
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
      <TouchableOpacity onPress={pickImage} disabled={loading}>
        <Text>{loading ? '处理中...' : '选择图片'}</Text>
      </TouchableOpacity>
      
      {result && (
        <Image source={{ uri: result }} style={{ width: 200, height: 200 }} />
      )}
    </View>
  );
};
```

### 3. 后端集成

#### Node.js集成

```javascript
const express = require('express');
const multer = require('multer');
const fs = require('fs');
const path = require('path');

const app = express();
const upload = multer({ dest: 'uploads/' });

// 处理图片上传和AI处理
app.post('/process-hairstyle', upload.single('image'), async (req, res) => {
  try {
    const imageFile = req.file;
    
    // 读取图片文件并转换为Base64
    const imageBuffer = fs.readFileSync(imageFile.path);
    const base64Image = imageBuffer.toString('base64');
    
    // 调用AILabTools API
    const response = await fetch('https://api.ailabtools.com/v1/hairstyle-editor-pro', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer YOUR_API_KEY',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        image: `data:image/jpeg;base64,${base64Image}`,
        hairstyle: req.body.hairstyle || 'short',
        hair_color: req.body.hair_color || 'black'
      })
    });
    
    const result = await response.json();
    
    if (result.error_code === 0) {
      // 轮询获取结果
      const finalResult = await pollTaskResult(result.result.task_id);
      
      // 清理临时文件
      fs.unlinkSync(imageFile.path);
      
      res.json({
        success: true,
        result: finalResult
      });
    } else {
      res.status(400).json({
        success: false,
        error: result.error_detail.message
      });
    }
    
  } catch (error) {
    res.status(500).json({
      success: false,
      error: '服务器错误'
    });
  }
});

// 轮询任务结果
async function pollTaskResult(taskId, maxAttempts = 100) {
  for (let attempt = 0; attempt < maxAttempts; attempt++) {
    const response = await fetch(
      `https://api.ailabtools.com/v1/async-task-results?task_id=${taskId}`,
      {
        headers: {
          'Authorization': 'Bearer YOUR_API_KEY'
        }
      }
    );
    
    const result = await response.json();
    
    if (result.result.status === 'completed') {
      return result.result.result_image;
    } else if (result.result.status === 'failed') {
      throw new Error('任务处理失败');
    }
    
    // 等待5秒后重试
    await new Promise(resolve => setTimeout(resolve, 5000));
  }
  
  throw new Error('查询超时');
}

app.listen(3000, () => {
  console.log('服务器运行在端口3000');
});
```

#### Python集成

```python
from flask import Flask, request, jsonify
import requests
import base64
import time
import os

app = Flask(__name__)

@app.route('/process-hairstyle', methods=['POST'])
def process_hairstyle():
    try:
        # 获取上传的图片
        if 'image' not in request.files:
            return jsonify({'error': '没有上传图片'}), 400
        
        image_file = request.files['image']
        
        # 读取图片并转换为Base64
        image_data = image_file.read()
        base64_image = base64.b64encode(image_data).decode('utf-8')
        
        # 获取参数
        hairstyle = request.form.get('hairstyle', 'short')
        hair_color = request.form.get('hair_color', 'black')
        
        # 调用AILabTools API
        response = requests.post(
            'https://api.ailabtools.com/v1/hairstyle-editor-pro',
            headers={
                'Authorization': 'Bearer YOUR_API_KEY',
                'Content-Type': 'application/json'
            },
            json={
                'image': f'data:image/jpeg;base64,{base64_image}',
                'hairstyle': hairstyle,
                'hair_color': hair_color
            }
        )
        
        result = response.json()
        
        if result['error_code'] == 0:
            # 轮询获取结果
            final_result = poll_task_result(result['result']['task_id'])
            
            return jsonify({
                'success': True,
                'result': final_result
            })
        else:
            return jsonify({
                'success': False,
                'error': result['error_detail']['message']
            }), 400
            
    except Exception as e:
        return jsonify({
            'success': False,
            'error': str(e)
        }), 500

def poll_task_result(task_id, max_attempts=100):
    """轮询任务结果"""
    for attempt in range(max_attempts):
        response = requests.get(
            'https://api.ailabtools.com/v1/async-task-results',
            params={'task_id': task_id},
            headers={'Authorization': 'Bearer YOUR_API_KEY'}
        )
        
        result = response.json()
        
        if result['result']['status'] == 'completed':
            return result['result']['result_image']
        elif result['result']['status'] == 'failed':
            raise Exception('任务处理失败')
        
        time.sleep(5)
    
    raise Exception('查询超时')

if __name__ == '__main__':
    app.run(debug=True, port=5000)
```

## 开发工具

### 1. SDK和库

#### JavaScript SDK

```bash
npm install ailabtools-sdk
```

```javascript
import { AILabTools } from 'ailabtools-sdk';

const client = new AILabTools('YOUR_API_KEY');

// 处理图片
const result = await client.hairstyleEditorPro({
  image: imageFile,
  hairstyle: 'short',
  hair_color: 'black'
});

console.log(result);
```

#### Python SDK

```bash
pip install ailabtools
```

```python
from ailabtools import AILabTools

client = AILabTools('YOUR_API_KEY')

# 处理图片
result = client.hairstyle_editor_pro(
    image_path='image.jpg',
    hairstyle='short',
    hair_color='black'
)

print(result)
```

### 2. 开发环境配置

#### 环境变量

```bash
# .env 文件
AILABTOOLS_API_KEY=sk-1234567890abcdef
AILABTOOLS_BASE_URL=https://api.ailabtools.com/v1
```

#### 配置文件

```javascript
// config.js
const config = {
  apiKey: process.env.AILABTOOLS_API_KEY,
  baseUrl: process.env.AILABTOOLS_BASE_URL || 'https://api.ailabtools.com/v1',
  timeout: 30000,
  retries: 3
};

export default config;
```

## 测试和调试

### 1. API测试

```javascript
// 使用Postman或类似工具测试API
const testRequest = {
  method: 'POST',
  url: 'https://api.ailabtools.com/v1/hairstyle-editor-pro',
  headers: {
    'Authorization': 'Bearer YOUR_API_KEY',
    'Content-Type': 'application/json'
  },
  body: {
    image: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...',
    hairstyle: 'short',
    hair_color: 'black'
  }
};
```

### 2. 错误调试

```javascript
// 错误调试工具
class APIDebugger {
  static logRequest(request) {
    console.log('API Request:', {
      url: request.url,
      method: request.method,
      headers: request.headers,
      body: request.body
    });
  }
  
  static logResponse(response) {
    console.log('API Response:', {
      status: response.status,
      headers: response.headers,
      body: response.body
    });
  }
  
  static logError(error) {
    console.error('API Error:', {
      message: error.message,
      code: error.code,
      stack: error.stack
    });
  }
}
```

## 部署建议

### 1. 生产环境配置

- 使用环境变量管理API密钥
- 实现请求重试机制
- 添加错误监控和日志记录
- 配置适当的超时时间

### 2. 性能优化

- 实现图片预处理和压缩
- 使用缓存减少重复请求
- 实现并发请求控制
- 监控API调用性能

<CTA href="/essentials/best-practices">
  查看最佳实践
</CTA>
