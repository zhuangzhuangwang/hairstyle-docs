---
title: "异步任务查询"
description: "查询异步任务的处理结果，获取最终的图片处理结果"
openapi: "openapi.json GET /async-task-results"
---

# 异步任务查询

查询异步任务的处理结果，获取最终的图片处理结果。

<Tip>
对于异步接口，调用API后返回的结果不是真实的请求结果，您需要保存返回结果中的`task_id`，然后调用此接口获取真实的请求结果。
</Tip>

## 任务状态

| 状态 | 描述 |
|------|------|
| `pending` | 等待处理 |
| `processing` | 处理中 |
| `completed` | 处理完成 |
| `failed` | 处理失败 |

<Warning>
异步任务结果有效期为24小时。建议每5秒查询一次异步任务结果。
</Warning>

## 错误码

| 错误码 | 描述 |
|--------|------|
| 0 | 成功 |
| 1001 | 参数错误 |
| 2001 | 任务不存在 |
| 2002 | 任务已过期 |
| 2003 | 任务处理失败 |

## 使用示例

<Tabs>
<Tab title="JavaScript">
```javascript
async function pollTaskResult(taskId) {
  const maxAttempts = 100; // 最多尝试100次
  let attempts = 0;
  
  while (attempts < maxAttempts) {
    const response = await fetch(
      `https://api.ailabtools.com/v1/async-task-results?task_id=${taskId}`,
      {
        headers: {
          'Authorization': 'Bearer YOUR_API_KEY'
        }
      }
    );
    
    const result = await response.json();
    
    if (result.result.status === 'completed') {
      return result.result.result_image;
    } else if (result.result.status === 'failed') {
      throw new Error('任务处理失败');
    }
    
    // 等待5秒后重试
    await new Promise(resolve => setTimeout(resolve, 5000));
    attempts++;
  }
  
  throw new Error('查询超时');
}

// 使用示例
const taskId = 'task_abcdef123456';
const resultImage = await pollTaskResult(taskId);
console.log('处理完成:', resultImage);
```
</Tab>

<Tab title="Python">
```python
import requests
import time

def poll_task_result(task_id, max_attempts=100):
    """轮询任务结果"""
    for attempt in range(max_attempts):
        response = requests.get(
            'https://api.ailabtools.com/v1/async-task-results',
            params={'task_id': task_id},
            headers={'Authorization': 'Bearer YOUR_API_KEY'}
        )
        
        result = response.json()
        
        if result['result']['status'] == 'completed':
            return result['result']['result_image']
        elif result['result']['status'] == 'failed':
            raise Exception('任务处理失败')
        
        # 等待5秒后重试
        time.sleep(5)
    
    raise Exception('查询超时')

# 使用示例
task_id = 'task_abcdef123456'
result_image = poll_task_result(task_id)
print('处理完成:', result_image)
```
</Tab>

<Tab title="cURL">
```bash
# 查询任务状态
curl -X GET "https://api.ailabtools.com/v1/async-task-results?task_id=task_abcdef123456" \
  -H "Authorization: Bearer YOUR_API_KEY"

# 轮询脚本示例
#!/bin/bash
task_id="task_abcdef123456"
max_attempts=100

for i in $(seq 1 $max_attempts); do
  response=$(curl -s -X GET \
    "https://api.ailabtools.com/v1/async-task-results?task_id=$task_id" \
    -H "Authorization: Bearer YOUR_API_KEY")
  
  status=$(echo $response | jq -r '.result.status')
  
  if [ "$status" = "completed" ]; then
    echo "任务完成"
    echo $response | jq -r '.result.result_image' > result.jpg
    break
  elif [ "$status" = "failed" ]; then
    echo "任务失败"
    exit 1
  fi
  
  echo "等待中... ($i/$max_attempts)"
  sleep 5
done
```
</Tab>
</Tabs>
