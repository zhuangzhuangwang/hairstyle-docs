openapi: 3.0.0
info:
  title: AILabTools API
  version: 1.0.0
  description: 基于稳定扩散模型的发型编辑Pro功能API
  contact:
    name: AILabTools Support
    email: support@ailabtools.com
    url: https://www.ailabtools.com
servers:
  - url: https://api.ailabtools.com/v1
    description: 生产环境
  - url: https://api-staging.ailabtools.com/v1
    description: 测试环境

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: 请输入您的API密钥，格式为 sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
  
  schemas:
    # 通用响应格式
    BaseResponse:
      type: object
      properties:
        request_id:
          type: string
          description: 请求ID
          example: "req_123456789"
        log_id:
          type: string
          description: 日志ID
          example: "log_987654321"
        error_code:
          type: integer
          description: 错误码，0表示成功
          example: 0
    
    # 发型编辑请求
    HairstyleEditorRequest:
      type: object
      required:
        - image
      properties:
        image:
          type: string
          format: byte
          description: Base64编码的图片数据，支持PNG、JPG、JPEG格式
          example: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
        hairstyle:
          type: string
          enum: ["short", "medium", "long", "buzzcut", "pompadour", "quiff", "slicked_back", "textured_crop", "bob", "pixie", "layered", "curly", "straight"]
          description: 发型类型
          example: "short"
        hair_color:
          type: string
          enum: ["black", "brown", "blonde", "red", "gray", "white", "auburn", "chestnut"]
          description: 发色
          example: "black"
    
    # 发型编辑响应
    HairstyleEditorResponse:
      allOf:
        - $ref: "#/components/schemas/BaseResponse"
        - type: object
          properties:
            result:
              type: object
              properties:
                task_id:
                  type: string
                  description: 异步任务ID，用于查询处理结果
                  example: "task_abcdef123456"
    
    # 异步任务响应
    AsyncTaskResponse:
      allOf:
        - $ref: "#/components/schemas/BaseResponse"
        - type: object
          properties:
            result:
              type: object
              properties:
                task_id:
                  type: string
                  description: 异步任务ID
                  example: "task_abcdef123456"
                status:
                  type: string
                  enum: ["pending", "processing", "completed", "failed"]
                  description: 任务状态
                  example: "completed"
                result_image:
                  type: string
                  format: byte
                  description: 处理结果图片（Base64编码）
                  example: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
    
    # 人脸分析请求
    FaceAnalysisRequest:
      type: object
      required:
        - image
      properties:
        image:
          type: string
          format: byte
          description: Base64编码的图片数据，支持PNG、JPG、JPEG格式
          example: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
    
    # 人脸分析响应
    FaceAnalysisResponse:
      allOf:
        - $ref: "#/components/schemas/BaseResponse"
        - type: object
          properties:
            result:
              type: object
              properties:
                face_num:
                  type: integer
                  description: 检测到的人脸数量
                  example: 1
                face_info:
                  type: array
                  items:
                    type: object
                    properties:
                      face_id:
                        type: string
                        description: 人脸ID
                        example: "face_001"
                      face_rect:
                        type: object
                        properties:
                          x:
                            type: integer
                            description: 人脸左上角X坐标
                            example: 100
                          y:
                            type: integer
                            description: 人脸左上角Y坐标
                            example: 50
                          width:
                            type: integer
                            description: 人脸宽度
                            example: 200
                          height:
                            type: integer
                            description: 人脸高度
                            example: 250
                      face_angle:
                        type: number
                        description: 人脸角度（度）
                        example: 15
                      face_proportion:
                        type: number
                        description: 人脸在图片中的占比（0-1）
                        example: 0.25
    
    # 错误响应
    ErrorResponse:
      allOf:
        - $ref: "#/components/schemas/BaseResponse"
        - type: object
          properties:
            error_detail:
              type: object
              properties:
                status_code:
                  type: integer
                  example: 400
                code:
                  type: string
                  example: "INVALID_PARAMETER"
                code_message:
                  type: string
                  example: "参数错误"
                message:
                  type: string
                  example: "请求参数无效"

paths:
  /hairstyle-editor-pro:
    post:
      summary: 发型编辑Pro
      description: 基于稳定扩散模型，智能编辑人像图片中的发型和颜色
      operationId: hairstyleEditorPro
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/HairstyleEditorRequest"
            examples:
              basic:
                summary: 基础示例
                value:
                  image: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
                  hairstyle: "short"
                  hair_color: "black"
              male_hairstyle:
                summary: 男性发型示例
                value:
                  image: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
                  hairstyle: "pompadour"
                  hair_color: "brown"
              female_hairstyle:
                summary: 女性发型示例
                value:
                  image: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
                  hairstyle: "bob"
                  hair_color: "blonde"
      responses:
        "200":
          description: 请求成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HairstyleEditorResponse"
              examples:
                success:
                  summary: 成功响应
                  value:
                    request_id: "req_123456789"
                    log_id: "log_987654321"
                    error_code: 0
                    result:
                      task_id: "task_abcdef123456"
        "400":
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                invalid_parameter:
                  summary: 参数错误
                  value:
                    request_id: "req_123456789"
                    log_id: "log_987654321"
                    error_code: 1001
                    error_detail:
                      status_code: 400
                      code: "INVALID_PARAMETER"
                      code_message: "参数错误"
                      message: "请求参数无效"
                no_face_detected:
                  summary: 未检测到人脸
                  value:
                    request_id: "req_123456789"
                    log_id: "log_987654321"
                    error_code: 1005
                    error_detail:
                      status_code: 400
                      code: "NO_FACE_DETECTED"
                      code_message: "未检测到人脸"
                      message: "图片中未检测到人脸"
        "401":
          description: 认证失败
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                auth_failed:
                  summary: 认证失败
                  value:
                    request_id: "req_123456789"
                    log_id: "log_987654321"
                    error_code: 2001
                    error_detail:
                      status_code: 401
                      code: "AUTHENTICATION_FAILED"
                      code_message: "认证失败"
                      message: "API密钥无效或已过期"
        "429":
          description: 请求频率超限
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                rate_limit:
                  summary: 频率超限
                  value:
                    request_id: "req_123456789"
                    log_id: "log_987654321"
                    error_code: 4001
                    error_detail:
                      status_code: 429
                      code: "RATE_LIMIT_EXCEEDED"
                      code_message: "请求频率超限"
                      message: "请求过于频繁，请稍后重试"

  /async-task-results:
    get:
      summary: 异步任务查询
      description: 查询异步任务的处理结果，获取最终的图片处理结果
      operationId: getAsyncTaskResults
      security:
        - BearerAuth: []
      parameters:
        - name: task_id
          in: query
          required: true
          schema:
            type: string
          description: 异步任务ID，从其他API响应中获取
          example: "task_abcdef123456"
      responses:
        "200":
          description: 请求成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AsyncTaskResponse"
              examples:
                completed:
                  summary: 任务完成
                  value:
                    request_id: "req_123456789"
                    log_id: "log_987654321"
                    error_code: 0
                    result:
                      task_id: "task_abcdef123456"
                      status: "completed"
                      result_image: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
                processing:
                  summary: 任务处理中
                  value:
                    request_id: "req_123456789"
                    log_id: "log_987654321"
                    error_code: 0
                    result:
                      task_id: "task_abcdef123456"
                      status: "processing"
                failed:
                  summary: 任务失败
                  value:
                    request_id: "req_123456789"
                    log_id: "log_987654321"
                    error_code: 0
                    result:
                      task_id: "task_abcdef123456"
                      status: "failed"
        "400":
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                missing_task_id:
                  summary: 缺少task_id参数
                  value:
                    request_id: "req_123456789"
                    log_id: "log_987654321"
                    error_code: 1001
                    error_detail:
                      status_code: 400
                      code: "MISSING_PARAMETER"
                      code_message: "缺少参数"
                      message: "task_id参数缺失"
        "401":
          description: 认证失败
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                auth_failed:
                  summary: 认证失败
                  value:
                    request_id: "req_123456789"
                    log_id: "log_987654321"
                    error_code: 2001
                    error_detail:
                      status_code: 401
                      code: "AUTHENTICATION_FAILED"
                      code_message: "认证失败"
                      message: "API密钥无效或已过期"
        "404":
          description: 任务不存在
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                task_not_found:
                  summary: 任务不存在
                  value:
                    request_id: "req_123456789"
                    log_id: "log_987654321"
                    error_code: 2001
                    error_detail:
                      status_code: 404
                      code: "TASK_NOT_FOUND"
                      code_message: "任务不存在"
                      message: "任务不存在或已过期"

  /face-analysis:
    post:
      summary: 人脸分析
      description: 分析图片中的人脸信息，包括人脸数量、位置、角度等，用于前端验证
      operationId: analyzeFace
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FaceAnalysisRequest"
            examples:
              basic:
                summary: 基础示例
                value:
                  image: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
      responses:
        "200":
          description: 请求成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FaceAnalysisResponse"
              examples:
                single_face:
                  summary: 检测到一个人脸
                  value:
                    request_id: "req_123456789"
                    log_id: "log_987654321"
                    error_code: 0
                    result:
                      face_num: 1
                      face_info:
                        - face_id: "face_001"
                          face_rect:
                            x: 100
                            y: 50
                            width: 200
                            height: 250
                          face_angle: 15
                          face_proportion: 0.25
                no_face:
                  summary: 未检测到人脸
                  value:
                    request_id: "req_123456789"
                    log_id: "log_987654321"
                    error_code: 0
                    result:
                      face_num: 0
                      face_info: []
                multiple_faces:
                  summary: 检测到多个人脸
                  value:
                    request_id: "req_123456789"
                    log_id: "log_987654321"
                    error_code: 0
                    result:
                      face_num: 2
                      face_info:
                        - face_id: "face_001"
                          face_rect:
                            x: 100
                            y: 50
                            width: 200
                            height: 250
                          face_angle: 15
                          face_proportion: 0.25
                        - face_id: "face_002"
                          face_rect:
                            x: 400
                            y: 50
                            width: 200
                            height: 250
                          face_angle: 10
                          face_proportion: 0.25
        "400":
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                invalid_parameter:
                  summary: 参数错误
                  value:
                    request_id: "req_123456789"
                    log_id: "log_987654321"
                    error_code: 1001
                    error_detail:
                      status_code: 400
                      code: "INVALID_PARAMETER"
                      code_message: "参数错误"
                      message: "请求参数无效"
        "401":
          description: 认证失败
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                auth_failed:
                  summary: 认证失败
                  value:
                    request_id: "req_123456789"
                    log_id: "log_987654321"
                    error_code: 2001
                    error_detail:
                      status_code: 401
                      code: "AUTHENTICATION_FAILED"
                      code_message: "认证失败"
                      message: "API密钥无效或已过期"
        "429":
          description: 请求频率超限
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                rate_limit:
                  summary: 频率超限
                  value:
                    request_id: "req_123456789"
                    log_id: "log_987654321"
                    error_code: 4001
                    error_detail:
                      status_code: 429
                      code: "RATE_LIMIT_EXCEEDED"
                      code_message: "请求频率超限"
                      message: "请求过于频繁，请稍后重试"
